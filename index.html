<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="./dist/aframe-street-component.js"></script>
    <script src="https://rawgit.com/protyze/aframe-curve-component/master/dist/aframe-curve-component.min.js"></script>
    <script src="alongpath.js"></script>
  
    <link rel="stylesheet" href="/style.css">
    <script src="look-at.js"></script>
    <script src="alongpath-scroll.js"></script>
    <style>
      a-scene {
        height: 100vh;
        width: 100vw;
        position: fixed;
        z-index: -1;
      }
      body { margin: 0px }
    </style>

    <!-- user controls -->
    <script src="https://raw.githack.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
    <script src="src/lib/aframe-orbit-controls.min.js"></script>

    <!-- ocean, ground, sky -->
    <script src="src/components/ocean-plane.js"></script>
    <script src="src/lib/aframe-cubemap-component.js"></script>

    <!-- 2d ui toolbar -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <!-- move a-frame performance `stats` below toolbar -->
    <style>
      .rs-base {
        left: 20px;
        top: 80px;
      }
    </style>

  </head>
  <body>
    <div class="aframe-bg">
      <a-scene embedded vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false" gltf-model="dracoDecoderPath: https://www.gstatic.com/draco/v1/decoders/;">
  
      <!--Camera Path-->
      <a-curve id="cameraPath" curve="closed: true">
        <a-curve-point class="pt1" position="0 20 85" curve-point=""></a-curve-point>
        <a-curve-point class="pt2" position="-43 28 -100" curve-point=""></a-curve-point>
        <a-curve-point class="pt3" position="5 5 -95" curve-point=""></a-curve-point>     
        <a-curve-point class="pt4" position="95 3 0" curve-point=""></a-curve-point>     
        <a-curve-point class="pt5" position="0 20 85" curve-point=""></a-curve-point>
      </a-curve>
  
      <a-curve id="targetPath" curve="closed: true">
        <a-curve-point class="pt1" position="0 0 0" curve-point=""></a-curve-point>
        <a-curve-point class="pt2" position="0 5 -90" curve-point=""></a-curve-point>
        <a-curve-point class="pt3" position="-5 5 -85" curve-point=""></a-curve-point>     
        <a-curve-point class="pt4" position="0 0 0" curve-point=""></a-curve-point>     
        <a-curve-point class="pt5" position="0 0 0" curve-point=""></a-curve-point>
      </a-curve>
  
      <!--Generated Curve For Paths-->
      <a-draw-curve curveref="#cameraPath" material="shader: line; color: blue;"></a-draw-curve>
      <a-draw-curve curveref="#targetPath" material="shader: line; color: red;"></a-draw-curve>
      
      <!--Camera Setup Using Look-At Component-->
      <a-camera id="mainCam" alongpath-scroll="curve: #cameraPath" position="0 20 85" camera="fov: 50" look-at="#bullseye"></a-camera>
      
      <a-entity id="mySimpleStreet" street streetmix-loader="streetmixStreetURL: https://streetmix.net/kfarr/3/" ></a-entity>
  
      <a-entity id="mySimpleStreet2" position="0 0 -179" street="right: parking-lot" streetmix-loader="showBuildings: false; streetmixStreetURL: https://streetmix.net/kfarr/3/" ></a-entity>
  
      <a-entity id="mySimpleStreet3" position="0 0 -89.5" rotation="0 90 0" street="length: 325" streetmix-loader="showBuildings: false; streetmixStreetURL: https://streetmix.net/kfarr/15/" ></a-entity>
  
      <!--Target For Camera Focus To Stay Fixed On-->
      <a-sphere id="bullseye" color="red" radius="2" position="0 0 0" visible="true" alongpath-scroll="curve: #targetPath" ></a-sphere>
  
      </a-scene>
    </div>
    
    <div class="section wf-section">
        <div class="div-block">
          <h1 class="heading">Headline 1 Here</h1>
          <p class="paragraph">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.</p>
        </div>
      </div>
      <div class="section wf-section">
        <div class="div-block">
          <h1 class="heading">Headline 2 Here</h1>
          <p class="paragraph">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.</p>
        </div>
      </div>
      <div class="section wf-section">
        <div class="div-block">
          <h1 class="heading">Headline 3 Here</h1>
          <p class="paragraph">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.</p>
        </div>
      </div>
      <div class="section wf-section">
        <div class="div-block">
          <h1 class="heading">Headline 4 Here</h1>
          <p class="paragraph">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.</p>
        </div>
      </div>
        <div class="section wf-section">
        <div class="div-block">
          <h1 class="heading">Headline 5 Here</h1>
          <p class="paragraph">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.</p>
        </div>
      </div>  
  </body>
  <script>
    AFRAME.registerComponent('set-loader-from-hash', {
      dependencies: ['streetmix-loader'],
      schema: {
        defaultURL: { type: 'string' }
      },
      init: function () {
        // get hash from window
        const streetURL = window.location.hash.substring(1);
        if (streetURL !== undefined && streetURL.length > 0) {
          console.log('[set-loader-from-hash]','Using URL from hash', streetURL)
          this.el.setAttribute('streetmix-loader', 'streetmixStreetURL', streetURL);
        } else {
          console.log('[set-loader-from-hash]','Using default URL', this.data.defaultURL)
          this.el.setAttribute('streetmix-loader', 'streetmixStreetURL', this.data.defaultURL);
        }
      }
    });

    window.onload = function () {
      if (window.location.hash.substring(1).length === 0) window.location.hash = '#https://streetmix.net/kfarr/3';
      document.querySelector('#inputUrl').value = window.location.hash.substring(1);
    }

    function startAudio() {
      // set sounds enabled in global state
      state.sounds.enabled = true;

      // iterate through all entities with .playme class and start them playing
      var entities = document.querySelectorAll('.playme'), i;
      for (i = 0; i < entities.length; ++i) {
        entities[i].components.sound.playSound();
      }

      // set 2D DOM toolbar volume icon to green to indicate state
      document.getElementById("audio-icon").setAttribute("class","fa fa-volume-up");
      document.getElementById("audio-icon").setAttribute("style","color: lightgreen");
    }

    document.querySelector('a-scene').addEventListener('enter-vr', function () {
      // console.log("ENTERED VR");
      // startAudio();
    });
  </script>
</html>
